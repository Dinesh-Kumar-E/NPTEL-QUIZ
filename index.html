<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizbuzz</title>
    <link rel="icon" href="https://art.pixilart.com/9953c1af326e635.gif" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8b58ff;
            --secondary: #ff5e5e;
            --dark: #222034;
            --light: #e6e6e6;
            --success: #52de97;
            --warning: #ffae22;
            --danger: #ff5555;
        }

        body {
            font-family: 'VT323', monospace;
            background-color: var(--dark);
            color: var(--light);
            font-size: 1.2rem;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p,
        label,
        div,
        span,
        button,
        input,
        select,
        option {
            color: white;
        }

        .form-label,
        .form-check-label {
            color: white;
        }

        .category-item label,
        .subcategory-item label {
            color: white;
        }

        .option-card {
            color: white;
        }


        .title {
            font-family: 'Press Start 2P', cursive;
            color: var(--primary);
            text-shadow: 2px 2px 0px var(--secondary);
            margin-bottom: 2rem;
        }

        .container {
            max-width: 800px;
            padding: 2rem;
        }

        .card {
            background-color: #2d2b4a;
            border: 3px solid var(--primary);
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            padding: 1.5rem;
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            padding: 0.75rem 1.5rem;
            box-shadow: 0 4px 0 #4b3b8a;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background-color: #7649e6;
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #4b3b8a;
        }

        .btn-primary:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #4b3b8a;
        }

        .form-control {
            background-color: #343358;
            border: 2px solid var(--primary);
            color: var(--light);
            padding: 0.75rem;
            font-size: 1.2rem;
        }

        .form-control:focus {
            background-color: #3e3e6e;
            color: var(--light);
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(139, 88, 255, 0.5);
        }

        .sound-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 2rem;
            cursor: pointer;
            color: var(--light);
            transition: color 0.3s;
        }

        .sound-toggle:hover {
            color: var(--secondary);
        }

        .option-selected {
            color: white;
        }

        .option-card {
            background-color: #343358;
            border: 2px solid #444880;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-card:hover {
            background-color: #3e3e6e;
            transform: translateY(-2px);
        }

        .option-selected {
            background-color: #4657ce;
            border-color: #6c78de;
        }

        .option-correct {
            background-color: var(--success);
            border-color: #3ebe7e;
            color: #222;
            animation: flash 0.5s;
        }

        .option-incorrect {
            background-color: var(--danger);
            border-color: #dd4444;
        }

        @keyframes flash {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .progress {
            height: 1.5rem;
            background-color: #343358;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .progress-bar {
            background-color: var(--primary);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7rem;
            line-height: 1.5rem;
        }

        .timer {
            font-family: 'Press Start 2P', cursive;
            color: var(--secondary);
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .screen {
            display: none;
        }

        #home-screen {
            display: block;
        }

        .slider-container {
            margin: 2rem 0;
        }

        .form-range {
            accent-color: var(--primary);
        }

        .form-check-input {
            width: 3rem;
            height: 1.5rem;
            accent-color: var(--primary);
        }

        .countdown {
            font-family: 'Press Start 2P', cursive;
            font-size: 5rem;
            color: var(--primary);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
        }

        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            animation: fall linear forwards;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
            }
        }

        .multi-select {
            background-color: #343358;
            border: 2px solid var(--primary);
            color: var(--light);
            border-radius: 4px;
            padding: 0.5rem;
            min-height: 100px;
        }

        .multi-select option {
            padding: 0.5rem;
            margin-bottom: 2px;
            background-color: #3e3e6e;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            background-color: #343358;
            border: 2px solid var(--danger);
            color: var(--light);
        }

        .multi-select {
            background-color: #343358;
            border: 2px solid var(--primary);
            color: var(--light);
            border-radius: 8px;
            padding: 0.5rem;
            min-height: 150px;
            overflow-y: auto;
        }

        .multi-select option {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            background-color: #3e3e6e;
            cursor: pointer;
        }

        .multi-select option:checked,
        .multi-select option:selected {
            background-color: var(--primary);
            color: white;
            font-weight: bold;
        }

        .category-helper {
            font-size: 0.9rem;
            color: #a9a9cc;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }

        .category-selection,
        .subcategory-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            background-color: #343358;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 12px;
        }

        .category-item,
        .subcategory-item {
            background-color: #3e3e6e;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            display: flex;
            align-items: center;
        }

        .category-item:hover,
        .subcategory-item:hover {
            background-color: #4b4b8c;
        }

        .category-item input,
        .subcategory-item input {
            margin-right: 8px;
        }

        .category-item label,
        .subcategory-item label {
            margin-bottom: 0;
            cursor: pointer;
        }

        .category-item.selected,
        .subcategory-item.selected {
            background-color: var(--primary);
            color: white;
        }

        @media (max-width: 576px) {

            .category-item,
            .subcategory-item {
                flex-basis: 100%;
            }
        }

        /* Additional fixes for settings page */
        #settings-screen label {
            color: white !important;
        }

        #settings-screen .form-check-label {
            color: white !important;
        }

        #settings-screen .form-text {
            color: #e6e6e6 !important;
        }

        /* Ensure text in checkboxes and radio buttons are white */
        .form-check input[type="checkbox"]+label,
        .form-check input[type="radio"]+label {
            color: white !important;
        }

        /* Ensure any helper text or descriptions are visible */
        small,
        .text-muted {
            color: #cccccc !important;
        }

        /* Fix any potential Bootstrap overrides */
        .text-dark {
            color: white !important;
        }
    </style>
</head>

<body>
    <div class="toast-container"></div>

    <div class="sound-toggle-container" style="position: absolute; top: 1rem; right: 1rem; display: flex; align-items: center; gap: 1rem; z-index: 100;">
        <div id="sound-control" class="sound-toggle" title="Toggle Sound">
            <i class="fas fa-volume-up"></i>
        </div>
    </div>



    <audio id="background-music" loop>
        <source src="asserts/8bit-retro-bg-1-trim.mp3" type="audio/mpeg">
    </audio>

    <audio id="success-sound">
        <source src="asserts/won1.mp3" type="audio/mpeg">
    </audio>

    <audio id="failure-sound">
        <source src="asserts/lost1.mp3" type="audio/mpeg">
    </audio>

    <!-- Home Screen -->
    <div id="home-screen" class="screen">
        <div class="container">
            <div class="text-center mb-5">
                <h1 class="title">QUIZBUZZ</h1>
            </div>
            <div class="card">
                <div class="text-center">
                    <h2 class="mb-4">Welcome to the Quiz!</h2>
                    <div class="mb-4">
                        <input type="text" id="player-name" class="form-control mb-3" placeholder="Enter your name">
                        <button id="start-btn" class="btn btn-primary btn-lg">GO!</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Documentation icon at bottom right -->
        <div id="docs-icon" style="position: fixed; bottom: 20px; right: 20px; z-index: 100;">
            <a href="docs.html" id="docs-control" class="btn btn-primary rounded-circle" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;" title="Documentation">
                <i class="fas fa-book"></i>
            </a>
        </div>
    </div>

    <!-- Room ID Screen -->
    <div id="room-screen" class="screen">
        <div class="container">
            <div class="text-center mb-5">
                <h1 class="title">ENTER ROOM</h1>
            </div>
            <div class="card">
                <div class="mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <label for="room-id" class="form-label me-2 mb-0">Room ID</label>
                        <div class="info-icon ms-1" data-bs-toggle="tooltip" data-bs-placement="right" 
                             title="Enter the Room ID provided by your instructor. If you don't have one, leave it as is. Room IDs are required to access specific quiz content. For information on creating rooms, please refer to the documentation.">
                            <i class="fas fa-info-circle text-primary"></i>
                        </div>
                    </div>
                    <input type="text" id="room-id" class="form-control mb-3" placeholder="Enter room ID">
                    <button id="search-room-btn" class="btn btn-primary">SEARCH ROOM</button>
                
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Settings Screen -->
    <div id="settings-screen" class="screen">
        <div class="container">
            <div class="text-center mb-4">
                <h1 class="title">QUIZ SETTINGS</h1>
            </div>
            <div class="card">
                <!-- Replace the existing category and subcategory selects with these divs -->
                <div id="category-container" class="mb-4">
                    <!-- Categories will be populated here by JavaScript -->
                </div>

                <div id="subcategory-container" class="mb-4">
                    <!-- Subcategories will be populated here by JavaScript -->
                </div>

                <div class="slider-container">
                    <label for="question-percent" class="form-label">Percentage of Questions(Choosen at random): <span
                            id="percent-value">100</span>%</label>
                    <input type="range" class="form-range" id="question-percent" min="10" max="100" value="100">
                </div>

                <div class="text-center mb-4">
                    <img id="percentage-image" src="asserts/9.webp" alt="Difficulty level"
                        style="width: 200px; height: 150px; object-fit: cover; border: 2px solid var(--primary); border-radius: 8px;">
                </div>

                <script>
                    document.getElementById('question-percent').addEventListener('input', function () {
                        const percentValue = parseInt(this.value);
                        document.getElementById('percent-value').textContent = percentValue;

                        // Determine which image to show based on the range
                        let imageNumber;
                        if (percentValue <= 20) imageNumber = 1;
                        else if (percentValue <= 30) imageNumber = 2;
                        else if (percentValue <= 40) imageNumber = 3;
                        else if (percentValue <= 50) imageNumber = 4;
                        else if (percentValue <= 60) imageNumber = 5;
                        else if (percentValue <= 70) imageNumber = 6;
                        else if (percentValue <= 80) imageNumber = 7;
                        else if (percentValue < 95) imageNumber = 8;
                        else imageNumber = 9;

                        // Update the image source
                        document.getElementById('percentage-image').src = `asserts/${imageNumber}.webp`;
                    });
                </script>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="shuffle-questions" checked>
                    <label class="form-check-label" for="shuffle-questions">Shuffle Questions</label>
                </div>

                <div class="form-check form-switch mb-4">
                    <input class="form-check-input" type="checkbox" id="shuffle-options" checked>
                    <label class="form-check-label" for="shuffle-options">Shuffle Options</label>
                </div>

                <div class="text-center">
                    <button id="begin-quiz-btn" class="btn btn-primary btn-lg">BEGIN QUIZ!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen" class="screen">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="timer" id="quiz-timer">00:00</div>
                <div class="progress w-75">
                    <div id="quiz-progress" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
                </div>
            </div>

            <div class="card mb-4">
                <h2 id="question-text" class="mb-4">Be Ready ! Question goes here !</h2>
                <div id="question-info"></div>

                <div id="options-container">
                    <!-- Options will be added here -->
                </div>

                <div class="text-center mt-4">
                    <button id="check-btn" class="btn btn-primary">CHECK</button>
                </div>
            </div>
        </div>

        <div id="countdown-display" style="display: none;">
            <div class="countdown">3</div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="screen">
        <div class="container">
            <div class="text-center mb-4">
                <h1 class="title">QUIZ RESULTS</h1>
            </div>

            <div class="card mb-4">
                <div class="text-center mb-4">
                    <h2>Your Score</h2>
                    <h3 id="score-display" class="mb-3">0/0 (0%)</h3>
                    <p id="result-message" class="mb-4">You completed the quiz!</p>
                </div>

                <div class="text-center mb-3">
                    <button id="show-wrong-btn" class="btn btn-primary">VIEW WRONG ANSWERS</button>
                </div>
            </div>

            <div id="wrong-answers-container" class="mt-4" style="display: none;">
                <h3 class="mb-3">Wrong Answers</h3>
                <div id="wrong-questions-list">
                    <!-- Wrong questions will be displayed here -->
                </div>
            </div>

            <div class="text-center mt-4">
                <button id="retry-btn" class="btn btn-primary btn-lg">RETRY QUIZ</button>
            </div>
        </div>

        <div class="confetti-container" id="confetti-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <script>
        // Global variables
        let quizData = null;
        let selectedCategories = [];
        let selectedSubcategories = [];
        let filteredQuestions = [];
        let currentQuizQuestions = [];
        let currentQuestionIndex = 0;
        let selectedOptions = [];
        let userScore = 0;
        let wrongAnswers = [];
        let timerInterval = null;
        let quizStartTime = null;

        // DOM Elements
        const homeScreen = document.getElementById('home-screen');
        const roomScreen = document.getElementById('room-screen');
        const settingsScreen = document.getElementById('settings-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');

        const playerNameInput = document.getElementById('player-name');
        const startBtn = document.getElementById('start-btn');
        const roomIdInput = document.getElementById('room-id');
        const searchRoomBtn = document.getElementById('search-room-btn');
        const categorySelect = document.getElementById('category-select');
        const subcategorySelect = document.getElementById('subcategory-select');
        const questionPercentInput = document.getElementById('question-percent');
        const percentValueDisplay = document.getElementById('percent-value');
        const shuffleQuestionsCheck = document.getElementById('shuffle-questions');
        const shuffleOptionsCheck = document.getElementById('shuffle-options');
        const beginQuizBtn = document.getElementById('begin-quiz-btn');
        const quizTimer = document.getElementById('quiz-timer');
        const quizProgress = document.getElementById('quiz-progress');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const checkBtn = document.getElementById('check-btn');
        const countdownDisplay = document.getElementById('countdown-display');
        const scoreDisplay = document.getElementById('score-display');
        const resultMessage = document.getElementById('result-message');
        const showWrongBtn = document.getElementById('show-wrong-btn');
        const wrongAnswersContainer = document.getElementById('wrong-answers-container');
        const wrongQuestionsList = document.getElementById('wrong-questions-list');
        const retryBtn = document.getElementById('retry-btn');
        const confettiContainer = document.getElementById('confetti-container');

        // Audio elements
        const backgroundMusic = document.getElementById('background-music');
        const successSound = document.getElementById('success-sound');
        const failureSound = document.getElementById('failure-sound');
        const soundControl = document.getElementById('sound-control');

        // Initialize application
        function init() {
            // Get room ID from URL if present
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('room')) {
                roomIdInput.value = urlParams.get('room');
            }

            // Set up event listeners
            startBtn.addEventListener('click', startQuiz);
            searchRoomBtn.addEventListener('click', searchRoom);
            // Remove the line referring to categorySelect
            questionPercentInput.addEventListener('input', updatePercentageDisplay);
            beginQuizBtn.addEventListener('click', setupQuiz);
            checkBtn.addEventListener('click', checkAnswer);
            showWrongBtn.addEventListener('click', toggleWrongAnswers);
            retryBtn.addEventListener('click', retryQuiz);

            // Sound control
            soundControl.addEventListener('click', toggleSound);

            // Handle music autoplay restrictions
            document.addEventListener('click', function () {
                if (backgroundMusic.paused) {
                    backgroundMusic.play().catch(e => console.error("Audio play failed:", e));
                }
            }, { once: true });
        }

        // Create and show toast message
        function showToast(message, type = 'danger') {
            const toastContainer = document.querySelector('.toast-container');

            const toast = document.createElement('div');
            toast.className = `toast show border-${type}`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');

            toast.innerHTML = `
                <div class="toast-header">
                    <strong class="me-auto">Quiz App</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;

            toastContainer.appendChild(toast);

            // Remove toast after 5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 5000);
        }

        // Toggle sound
        function toggleSound() {
            if (backgroundMusic.paused) {
                backgroundMusic.play();
                soundControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                localStorage.setItem('quizAudioMuted', 'false');
            } else {
                backgroundMusic.pause();
                soundControl.innerHTML = '<i class="fas fa-volume-mute"></i>';
                localStorage.setItem('quizAudioMuted', 'true');
            }
        }

        // Check audio preference from local storage on page load
        document.addEventListener('DOMContentLoaded', function () {
            const audioMuted = localStorage.getItem('quizAudioMuted') === 'true';

            if (audioMuted) {
                backgroundMusic.pause();
                soundControl.innerHTML = '<i class="fas fa-volume-mute"></i>';
            } else {
                // Don't auto-play, but keep the icon consistent
                soundControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                // We'll let the click handler start the music to avoid autoplay restrictions
            }
        });

        // Start quiz flow
        function startQuiz() {
            const playerName = playerNameInput.value.trim();
            if (!playerName) {
                showToast('Please enter your name to continue');
                return;
            }

            // Save player name to local storage
            localStorage.setItem('quizPlayerName', playerName);

            // Transition to room screen
            homeScreen.style.display = 'none';
            roomScreen.style.display = 'block';

            // Start background music
            backgroundMusic.play().catch(e => console.error("Audio play failed:", e));
        }

        // Add this to the init function or create a separate function to load saved name
        document.addEventListener('DOMContentLoaded', function () {
            // Load player name from local storage if available
            const savedPlayerName = localStorage.getItem('quizPlayerName');
            if (savedPlayerName) {
                playerNameInput.value = savedPlayerName;
            }
        });

        // Search for room
        function searchRoom() {
            const roomInput = roomIdInput.value.trim();
            if (!roomInput) {
                showToast('Please enter a room ID or URL');
                return;
            }

            // Check toggle state
            const isDirectUrl = document.getElementById('url-toggle').checked;
            
            // Validate input based on toggle state
            if (isDirectUrl) {
                // URL mode: Input should look like a URL
                if (!roomInput.includes('.') && !roomInput.startsWith('http')) {
                    showToast('Please enter a valid URL when in direct URL mode');
                    return;
                }
            } else {
                // Room ID mode: Input shouldn't look like a URL
                if (roomInput.includes('.') || roomInput.startsWith('http')) {
                    showToast('Please enter a room ID, not a URL, when in room ID mode');
                    return;
                }
            }
            
            // Determine the target URL based on toggle state
            let targetUrl;
            if (isDirectUrl) {
                // Direct URL mode - use input as-is
                targetUrl = roomInput.startsWith('http') ? roomInput : `https://${roomInput}`;
            } else {
                // Pastebin mode - treat input as a Pastebin ID
                targetUrl = `https://pastebin.com/raw/${roomInput}`;
            }
            
            // Show loading animation
            document.getElementById('search-animation').style.display = 'block';
            document.getElementById('search-room-btn').disabled = true;
            
            // Try with proxies if direct access fails
            fetch(targetUrl)
                .then(response => {
                    if (!response.ok) throw new Error('Direct access failed');
                    return response.json();
                })
                .catch(error => {
                    // Try with proxy if direct access fails
                    console.log('Direct access failed, trying proxy:', error);
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(targetUrl)}`;
                    return fetch(proxyUrl).then(response => {
                        if (!response.ok) throw new Error('Proxy access failed');
                        return response.json();
                    });
                })
                .then(data => {
                    quizData = data;
                    populateCategories();
                    roomScreen.style.display = 'none';
                    settingsScreen.style.display = 'block';
                })
                .catch(error => {
                    console.error('All fetch attempts failed:', error);
                    showToast('Failed to access data. Please check your input and try again.');
                })
                .finally(() => {
                    // Hide loading animation
                    document.getElementById('search-animation').style.display = 'none';
                    document.getElementById('search-room-btn').disabled = false;
                });
        }

        // Add this HTML right after the room-id input in the room screen:
        document.addEventListener('DOMContentLoaded', function() {
            // Insert toggle switch after room-id input
            const roomIdInput = document.getElementById('room-id');
            if (roomIdInput) {
                const toggleSwitch = document.createElement('div');
                toggleSwitch.className = 'form-check form-switch mt-2 mb-3';
                toggleSwitch.innerHTML = `
                    <label class="form-check-label d-flex align-items-center" for="url-toggle">
                        Treat as direct URL
                        <div class="info-icon ms-1" data-bs-toggle="tooltip" data-bs-placement="right" 
                             title="Toggle ON to use a direct JSON URL. Toggle OFF to use a Pastebin ID. Both methods will use proxies to fetch the data if needed.">
                            <i class="fas fa-info-circle text-primary"></i>
                        </div>
                    </label>
                    <div class="ms-auto">
                        <input class="form-check-input" type="checkbox" id="url-toggle">
                    </div>
                `;
                toggleSwitch.style.display = "flex";
                toggleSwitch.style.justifyContent = "space-between";
                toggleSwitch.style.alignItems = "center";
                roomIdInput.parentNode.insertBefore(toggleSwitch, roomIdInput.nextSibling);
                
                // Initialize tooltip
                var tooltip = new bootstrap.Tooltip(toggleSwitch.querySelector('[data-bs-toggle="tooltip"]'));
                
                // Update placeholder based on toggle state
                const urlToggle = document.getElementById('url-toggle');
                urlToggle.addEventListener('change', function() {
                    roomIdInput.placeholder = this.checked ? 'Enter direct URL' : 'Enter room ID';
                });
                
                // Add the loading animation after the toggle switch
                const loadingAnimation = document.createElement('div');
                loadingAnimation.id = 'search-animation';
                loadingAnimation.style.display = 'none';
                loadingAnimation.style.marginTop = '20px';
                loadingAnimation.innerHTML = `
                    <div class="search-animation-container">
                        <div class="search-bar">
                            <div class="search-box"></div>
                        </div>
                    </div>
                `;
                roomIdInput.parentNode.insertBefore(loadingAnimation, document.getElementById('search-room-btn'));
                
                // Add CSS for the loading animation
                const style = document.createElement('style');
                style.textContent = `
                    .search-animation-container {
                        position: relative;
                        width: 100%;
                        margin: 10px 0;
                        text-align: center;
                    }
                    
                    .search-bar {
                        height: 20px;
                        background-color: #343358;
                        border: 2px solid var(--primary);
                        border-radius: 10px;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .search-box {
                        position: absolute;
                        width: 20px;
                        height: 16px;
                        background-color: var(--primary);
                        border-radius: 5px;
                        animation: bounce 1s infinite linear;
                    }
                    
                    @keyframes bounce {
                        0%, 100% {
                            left: 5px;
                        }
                        50% {
                            left: calc(100% - 25px);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        });

        // Check for roomid parameter in URL and auto-fill it
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('roomid')) {
                const roomIdFromUrl = urlParams.get('roomid');
                roomIdInput.value = roomIdFromUrl;
                // Optionally auto-search the room
                // searchRoom();
            }
        });

        // Populate categories from fetched data
        function populateCategories() {
            if (!quizData || !quizData.questions || !quizData.questions.length) {
                showToast('Invalid quiz data format');
                return;
            }

            // Extract unique categories
            const categories = [...new Set(quizData.questions.map(q => q.category))];

            // Create a custom category selection UI
            const categoryContainer = document.getElementById('category-container');
            categoryContainer.innerHTML = `
        <label class="form-label">Choose Categories</label>
        <div class="category-selection mb-3">
            ${categories.map((category, idx) => `
                <div class="category-item" data-category="${category}">
                    <input type="checkbox" id="cat-${idx}" class="category-checkbox" value="${category}">
                    <label for="cat-${idx}">${category}</label>
                </div>
            `).join('')}
        </div>
    `;

            // Add event listeners to category checkboxes
            const categoryCheckboxes = document.querySelectorAll('.category-checkbox');
            categoryCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateSubcategories);
            });

            // Initialize subcategories based on all available categories
            updateSubcategories();
        }

        // Update subcategories based on selected categories
        function updateSubcategories() {
            // Get selected categories from checkboxes
            const categoryCheckboxes = document.querySelectorAll('.category-checkbox:checked');
            selectedCategories = Array.from(categoryCheckboxes).map(checkbox => checkbox.value);

            // If no categories selected, show subcategories from all categories
            const relevantQuestions = selectedCategories.length > 0
                ? quizData.questions.filter(q => selectedCategories.includes(q.category))
                : quizData.questions;

            // Extract unique subcategories from the filtered questions
            const subcategories = [...new Set(relevantQuestions.map(q => q.subcategory))];

            // Store previously selected subcategories to maintain them if possible
            const subcategoryContainer = document.getElementById('subcategory-container');
            const previouslySelected = Array.from(
                subcategoryContainer.querySelectorAll('.subcategory-checkbox:checked')
            ).map(checkbox => checkbox.value);

            // Clear and populate subcategory selection
            subcategoryContainer.innerHTML = `
        <div class="d-flex justify-content-between align-items-center mb-2">
            <label class="form-label mb-0">Choose Subcategories</label>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="select-all-subcategories">
                <label class="form-check-label" for="select-all-subcategories">.  Select All</label>
            </div>
        </div>
        <div class="subcategory-selection mb-3">
            ${subcategories.map((subcategory, idx) => `
                <div class="subcategory-item" data-subcategory="${subcategory}">
                    <input type="checkbox" id="subcat-${idx}" class="subcategory-checkbox" value="${subcategory}" 
                        ${previouslySelected.includes(subcategory) ? 'checked' : ''}>
                    <label for="subcat-${idx}">${subcategory}</label>
                </div>
            `).join('')}
        </div>
    `;

            // Add event listener to "select all" checkbox
            const selectAllCheckbox = document.getElementById('select-all-subcategories');
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function () {
                    const subcategoryCheckboxes = document.querySelectorAll('.subcategory-checkbox');
                    subcategoryCheckboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                });
            }
        }

        // Update percentage display
        function updatePercentageDisplay() {
            const percentValueDisplay = document.getElementById('percent-value');
            const questionPercentInput = document.getElementById('question-percent');
            percentValueDisplay.textContent = questionPercentInput.value;
            
        }

        // Initialize the percentage display and add event listener
        document.addEventListener('DOMContentLoaded', function () {
            const questionPercentInput = document.getElementById('question-percent');
            questionPercentInput.addEventListener('input', updatePercentageDisplay);
        });

        // Setup quiz based on selected settings
        function setupQuiz() {
            // Get selected categories from checkboxes
            const categoryCheckboxes = document.querySelectorAll('.category-checkbox:checked');
            selectedCategories = Array.from(categoryCheckboxes).map(checkbox => checkbox.value);

            // Get selected subcategories from checkboxes
            const subcategoryCheckboxes = document.querySelectorAll('.subcategory-checkbox:checked');
            selectedSubcategories = Array.from(subcategoryCheckboxes).map(checkbox => checkbox.value);

            // Check if at least one subcategory is selected
            if (selectedSubcategories.length === 0) {
                showToast('Please select at least one subcategory');
                return;
            }

            // Filter questions to include ANY selected category AND ANY selected subcategory
            filteredQuestions = quizData.questions.filter(question => {
                const categoryMatch = selectedCategories.length === 0 || selectedCategories.includes(question.category);
                const subcategoryMatch = selectedSubcategories.length === 0 || selectedSubcategories.includes(question.subcategory);

                return categoryMatch && subcategoryMatch;
            });

            if (filteredQuestions.length === 0) {
                showToast('No questions match the selected criteria');
                return;
            }

            // Determine number of questions to include
            const percentToUse = parseInt(questionPercentInput.value);
            const questionCount = Math.max(1, Math.floor(filteredQuestions.length * percentToUse / 100));
                
            // Shuffle questions if needed
            if (shuffleQuestionsCheck.checked) {
                shuffleArray(filteredQuestions);
            }

            // Select subset of questions
            currentQuizQuestions = filteredQuestions.slice(0, questionCount);

            // Reset quiz state
            currentQuestionIndex = 0;
            userScore = 0;
            wrongAnswers = [];

            // Transition to quiz with countdown
            settingsScreen.style.display = 'none';
            quizScreen.style.display = 'block';
            startCountdown();
        }

        // Start countdown animation
        function startCountdown() {
            const countdownElement = countdownDisplay.querySelector('.countdown');
            countdownDisplay.style.display = 'block';

            let count = 3;
            countdownElement.textContent = count;

            const countdownInterval = setInterval(() => {
                count--;

                if (count > 0) {
                    countdownElement.textContent = count;
                } else {
                    clearInterval(countdownInterval);
                    countdownDisplay.style.display = 'none';
                    startQuizTimer();
                    displayQuestion();
                }
            }, 1000);
        }

        // Start quiz timer
        function startQuizTimer() {
            quizStartTime = new Date();

            timerInterval = setInterval(() => {
                const currentTime = new Date();
                const elapsedTime = Math.floor((currentTime - quizStartTime) / 1000);

                const minutes = Math.floor(elapsedTime / 60);
                const seconds = elapsedTime % 60;

                quizTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Display current question
        function displayQuestion() {
            const currentQuestion = currentQuizQuestions[currentQuestionIndex];

            // Update progress
            const progress = ((currentQuestionIndex + 1) / currentQuizQuestions.length) * 100;
            quizProgress.style.width = `${progress}%`;
            quizProgress.textContent = `${Math.round(progress)}%`;

            // Display question with LaTeX support - preprocess for proper LaTeX rendering
            questionText.innerHTML = preprocessLatex(currentQuestion.question);

            // Add info button with category and subcategory information
            const questionInfo = document.getElementById('question-info');
            questionInfo.innerHTML = `
                <div class="info-button" id="question-info-btn">
                    <i class="fas fa-info-circle"></i>
                    <div class="info-tooltip">
                        <strong>Category:</strong> ${currentQuestion.category}<br>
                        <strong>Subcategory:</strong> ${currentQuestion.subcategory}
                    </div>
                </div>
            `;

            // Add event listeners for both hover and click
            const infoButton = document.getElementById('question-info-btn');
            infoButton.addEventListener('click', function(e) {
                this.classList.toggle('active');
                e.stopPropagation();
            });

            // Close tooltip when clicking elsewhere
            document.addEventListener('click', function() {
                infoButton.classList.remove('active');
            });

            // Create a copy of options for shuffling if needed
            let options = [...currentQuestion.options];
            if (shuffleOptionsCheck.checked) {
                shuffleArray(options);
            }

            // Clear selected options
            selectedOptions = [];

            // Populate options with LaTeX support
            optionsContainer.innerHTML = '';
            options.forEach(option => {
                const optionCard = document.createElement('div');
                optionCard.className = 'option-card';
                optionCard.dataset.optionNo = option.no;
                optionCard.innerHTML = preprocessLatex(option.option);

                optionCard.addEventListener('click', () => {
                    toggleOptionSelection(optionCard, option.no);
                });

                optionsContainer.appendChild(optionCard);
            });

            // Handle MathJax rendering
            renderMathJax();

            function renderMathJax() {
                if (!window.MathJax) {
                    // Load MathJax script with proper configuration
                    window.MathJax = {
                        tex: {
                            inlineMath: [['$', '$'], ['\\(', '\\)']],
                            displayMath: [['$$', '$$'], ['\\[', '\\]']]
                        },
                        options: {
                            enableMenu: false,
                            processHtmlClass: 'tex2jax_process',
                            ignoreHtmlClass: 'tex2jax_ignore'
                        },
                        startup: {
                            typeset: true,
                            pageReady: function() {
                                return MathJax.startup.defaultPageReady().then(function() {
                                    console.log("MathJax initial typesetting complete");
                                });
                            }
                        }
                    };
                    
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js';
                    script.async = true;
                    script.onload = function() {
                        // After MathJax is loaded, give it a moment to initialize
                        setTimeout(function() {
                            console.log("Typesetting after MathJax loaded");
                            try {
                                MathJax.typeset();
                            } catch (err) {
                                console.error('MathJax typesetting failed:', err);
                                handleMathErrors();
                            }
                        }, 500);
                    };
                    document.head.appendChild(script);
                } else {
                    // If MathJax is already loaded, use a small delay to ensure content is in the DOM
                    setTimeout(function() {
                        try {
                            console.log("Running MathJax typeset");
                            MathJax.typeset();
                        } catch (err) {
                            console.error('MathJax typesetting failed:', err);
                            handleMathErrors();
                        }
                    }, 100);
                }
            }

            // Function to handle math errors by highlighting problematic LaTeX content
            function handleMathErrors() {
                const mathElements = document.querySelectorAll('.MathJax_Error, mjx-merror');
                
                mathElements.forEach(errorElem => {
                    // Get the original TeX content that caused the error
                    let originalTeX = errorElem.getAttribute('data-mjx-error') || 
                                     errorElem.textContent || 
                                     'Unknown LaTeX error';
                    
                    // Create a replacement element with error styling
                    const errorContainer = document.createElement('span');
                    errorContainer.className = 'math-error';
                    errorContainer.style.color = 'red';
                    errorContainer.style.cursor = 'pointer';
                    errorContainer.style.textDecoration = 'underline';
                    errorContainer.style.position = 'relative';
                    errorContainer.textContent = originalTeX;
                    
                    // Add tooltip on hover
                    errorContainer.setAttribute('title', 'Math parsing error');
                    
                    // Replace the error element with our custom element
                    if (errorElem.parentNode) {
                        errorElem.parentNode.replaceChild(errorContainer, errorElem);
                    }
                });
                
                // Also scan for unprocessed math delimiters that might indicate errors
                const contentElements = [questionText, ...optionsContainer.querySelectorAll('.option-card')];
                
                contentElements.forEach(elem => {
                    // Look for unprocessed math delimiters (indicators of potential errors)
                    const content = elem.innerHTML;
                    
                    // Simple regex to find potential math markup that wasn't processed
                    const mathRegex = /(\$\$.*?\$\$|\$.*?\$|\\begin\{.*?\}.*?\\end\{.*?\})/gs;
                    
                    // Replace potential unprocessed math with highlighted version
                    elem.innerHTML = content.replace(mathRegex, (match, p1) => {
                        // Check if this match wasn't processed by MathJax
                        if (!match.previousElementSibling || 
                            !match.previousElementSibling.classList.contains('MathJax') ||
                            !match.previousElementSibling.classList.contains('mjx-chtml')) {
                            
                            return `<span class="math-error" style="color: red; cursor: pointer; text-decoration: underline;" 
                                   title="Math parsing error">${match}</span>`;
                        }
                        return match;
                    });
                });
            }

            // Reset check button
            checkBtn.textContent = 'CHECK';
            checkBtn.removeEventListener('click', nextQuestion);
            checkBtn.addEventListener('click', checkAnswer);
        }

        // Helper function to preprocess LaTeX content for proper rendering
        function preprocessLatex(text) {
            if (!text) return '';
            
            try {
                // Fix common LaTeX escaping issues in JSON data
                // Replace double backslashes with single backslashes for LaTeX commands
                return text.replace(/\\\\([a-zA-Z]+)/g, '\\$1')
                          .replace(/\\\\([^a-zA-Z])/g, '\\$1')
                          // Fix specific issues with right arrow and other symbols
                          .replace(/\\alpha\./g, '\\alpha.')
                          .replace(/\\beta\./g, '\\beta.')
                          .replace(/\\delta\./g, '\\delta.');
            } catch (err) {
                console.error('Error preprocessing LaTeX:', err);
                // If preprocessing fails, return the original text with error styling
                return `<span class="math-error" style="color: red; cursor: pointer;" 
                        title="Math parsing error">${text}</span>`;
            }
        }

        // Add this CSS to the existing <style> section
        document.head.insertAdjacentHTML('beforeend', `
        <style>
            .info-button {
                display: inline-block;
                margin-left: 10px;
                position: relative;
                cursor: pointer;
                color: var(--primary);
                font-size: 1.2rem;
                vertical-align: middle;
                transition: color 0.2s;
            }
            
            .info-button:hover {
                color: var(--secondary);
            }
            
            .info-tooltip {
                position: absolute;
                top: 100%;
                left: 0;
                background-color: #343358;
                border: 2px solid var(--primary);
                color: white;
                padding: 10px;
                border-radius: 8px;
                width: 250px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                z-index: 100;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s, visibility 0.3s;
                pointer-events: none;
                font-family: 'VT323', monospace;
            }
            
            .info-button:hover .info-tooltip,
            .info-button.active .info-tooltip {
                opacity: 1;
                visibility: visible;
            }
        </style>
        `);

        // Toggle option selection
        function toggleOptionSelection(optionCard, optionNo) {
            if (checkBtn.textContent === 'NEXT') {
                return; // Don't allow selection after answering
            }

            const index = selectedOptions.indexOf(optionNo);

            if (index === -1) {
                // Add selection
                selectedOptions.push(optionNo);
                optionCard.classList.add('option-selected');
            } else {
                // Remove selection
                selectedOptions.splice(index, 1);
                optionCard.classList.remove('option-selected');
            }
        }

        // Check answer
        function checkAnswer() {
            const currentQuestion = currentQuizQuestions[currentQuestionIndex];
            const correctOptions = currentQuestion.correctoption;

            // Handle case where no option is selected
            if (selectedOptions.length === 0) {
                showToast('Please select an option');
                return;
            }

            // Sort both arrays to compare them properly
            const sortedSelected = [...selectedOptions].sort((a, b) => a - b);
            const sortedCorrect = [...correctOptions].sort((a, b) => a - b);

            // Check if answer is exact match (no more, no less)
            const isCorrect =
                sortedSelected.length === sortedCorrect.length &&
                sortedSelected.every((value, index) => value === sortedCorrect[index]);

            // Update score
            if (isCorrect) {
                userScore++;
            } else {
                wrongAnswers.push({
                    question: currentQuestion,
                    selectedOptions: [...selectedOptions]
                });
            }

            // Highlight correct and incorrect options
            const optionCards = optionsContainer.querySelectorAll('.option-card');
            optionCards.forEach(card => {
                const optionNo = parseInt(card.dataset.optionNo);

                // Mark correct answers
                if (correctOptions.includes(optionNo)) {
                    card.classList.add('option-correct');
                }

                // Mark incorrect selections
                if (selectedOptions.includes(optionNo) && !correctOptions.includes(optionNo)) {
                    card.classList.add('option-incorrect');
                }

                // Mark missing selections
                if (!selectedOptions.includes(optionNo) && correctOptions.includes(optionNo)) {
                    card.classList.add('option-correct');
                    // Add a visual indicator for missed selection
                    card.classList.add('missed-selection');
                }
            });

            // Change check button to next
            checkBtn.textContent = 'NEXT';
            checkBtn.removeEventListener('click', checkAnswer);
            checkBtn.addEventListener('click', nextQuestion);
        }

        // Proceed to next question
        function nextQuestion() {
            currentQuestionIndex++;

            if (currentQuestionIndex < currentQuizQuestions.length) {
                displayQuestion();
            } else {
                endQuiz();
            }
        }

        // End quiz and show results
        function endQuiz() {
            // Stop timer
            clearInterval(timerInterval);

            // Calculate final score
            const scorePercentage = Math.round((userScore / currentQuizQuestions.length) * 100);
            scoreDisplay.textContent = `${userScore}/${currentQuizQuestions.length} (${scorePercentage}%)`;

            // Stop background music
            backgroundMusic.pause();

            // Show appropriate animation and play sound based on score
            if (scorePercentage >= 80) {
                resultMessage.textContent = 'Excellent job!';
                createConfetti('success');
                successSound.play().catch(e => console.error("Audio play failed:", e));
            } else {
                resultMessage.textContent = 'Better luck next time!';
                createConfetti('failure');
                failureSound.play().catch(e => console.error("Audio play failed:", e));
            }

            // Populate wrong answers if any
            if (wrongAnswers.length > 0) {
                populateWrongAnswers();
            } else {
                showWrongBtn.style.display = 'none';
            }

            // Show results screen
            quizScreen.style.display = 'none';
            resultsScreen.style.display = 'block';
        }

        // Populate wrong answers section
        function populateWrongAnswers() {
            wrongQuestionsList.innerHTML = '';

            wrongAnswers.forEach((item, index) => {
                const wrongQuestion = document.createElement('div');
                wrongQuestion.className = 'card mb-3 p-3';

                const question = item.question;
                const selectedOptions = item.selectedOptions;

                // Create question header with LaTeX support and info button
                const headerContainer = document.createElement('div');
                headerContainer.className = 'd-flex align-items-start';
                
                const questionHeader = document.createElement('h4');
                questionHeader.innerHTML = preprocessLatex(`Question ${index + 1}: ${question.question}`);
                headerContainer.appendChild(questionHeader);
                
                // Add info button with category and subcategory
                const infoButton = document.createElement('div');
                infoButton.className = 'info-button ms-2';
                infoButton.innerHTML = `
                    <i class="fas fa-info-circle"></i>
                    <div class="info-tooltip">
                        <strong>Category:</strong> ${question.category}<br>
                        <strong>Subcategory:</strong> ${question.subcategory}
                    </div>
                `;
                headerContainer.appendChild(infoButton);
                
                wrongQuestion.appendChild(headerContainer);

                // Create options list with LaTeX support
                const optionsList = document.createElement('div');
                optionsList.className = 'mt-3';

                question.options.forEach(option => {
                    const optionItem = document.createElement('div');
                    optionItem.className = 'option-card mb-2';

                    // Highlight user selection
                    if (selectedOptions.includes(option.no)) {
                        optionItem.classList.add('option-incorrect');
                    }

                    // Highlight correct answer
                    if (question.correctoption.includes(option.no)) {
                        optionItem.classList.add('option-correct');
                    }

                    // Use preprocessLatex for LaTeX rendering
                    optionItem.innerHTML = preprocessLatex(option.option);
                    optionsList.appendChild(optionItem);
                });

                wrongQuestion.appendChild(optionsList);
                wrongQuestionsList.appendChild(wrongQuestion);
                
                // Add event listeners for both hover and click on the info button
                infoButton.addEventListener('click', function(e) {
                    this.classList.toggle('active');
                    e.stopPropagation();
                });
            });

            // Close tooltips when clicking elsewhere
            document.addEventListener('click', function() {
                const infoButtons = wrongQuestionsList.querySelectorAll('.info-button');
                infoButtons.forEach(btn => btn.classList.remove('active'));
            });

            // Render LaTeX content in wrong answers
            setTimeout(() => {
                renderMathJax();
            }, 100);
        }

        // Toggle wrong answers visibility
        function toggleWrongAnswers() {
            if (wrongAnswersContainer.style.display === 'none') {
                wrongAnswersContainer.style.display = 'block';
                showWrongBtn.textContent = 'HIDE WRONG ANSWERS';
            } else {
                wrongAnswersContainer.style.display = 'none';
                showWrongBtn.textContent = 'VIEW WRONG ANSWERS';
            }
        }

        // Retry quiz
        function retryQuiz() {
            // Reset audio
            backgroundMusic.currentTime = 0;
            backgroundMusic.play().catch(e => console.error("Audio play failed:", e));

            // Clear confetti
            confettiContainer.innerHTML = '';

            // Go back to settings screen
            resultsScreen.style.display = 'none';
            settingsScreen.style.display = 'block';
        }

        // Create confetti animation
        function createConfetti(type) {
            const confettiCount = 200;
            const colors = type === 'success' ?
                ['#52de97', '#41b37e', '#ffae22', '#8b58ff', '#7649e6'] :
                ['#ff5555', '#dd4444', '#ffae22', '#444880', '#343358'];

            const types = type === 'success' ? ['🎉', '🎊', '🍰', '🍫', '✨'] : ['🃏', '💀', '👻', '🤡', '😈'];

            // Clear any existing confetti
            confettiContainer.innerHTML = '';

            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';

                // Random properties
                const left = Math.random() * 100;
                const size = Math.random() * 10 + 5;
                const backgroundIdx = Math.floor(Math.random() * colors.length);
                const typeIdx = Math.floor(Math.random() * types.length);
                const isEmoji = Math.random() > 0.7;  // 30% chance of emoji

                confetti.style.left = `${left}vw`;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.top = '-20px';

                if (isEmoji) {
                    confetti.innerHTML = types[typeIdx];
                    confetti.style.background = 'transparent';
                    confetti.style.fontSize = `${size * 2}px`;
                } else {
                    confetti.style.backgroundColor = colors[backgroundIdx];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                }

                // Animation properties
                const duration = Math.random() * 3 + 2;
                const delay = Math.random() * 5;

                confetti.style.animation = `fall ${duration}s linear ${delay}s forwards`;

                confettiContainer.appendChild(confetti);
            }
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>